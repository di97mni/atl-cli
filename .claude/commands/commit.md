# /commit Command

Create one or more logical commits from current changes following project conventions.

## Input
- Optional hint: `$ARGUMENTS` (e.g., "jira feature" or "fix config bug")

## Workflow

### 1. Analyze Changes
Run these commands to understand the current state:
```bash
git status
git diff
git diff --staged
git log --oneline -10
```

### 2. Security Scan
**CRITICAL: Scan ALL changed files for secrets before proceeding.**

Check for:
- API keys, tokens, passwords (patterns like `key=`, `token=`, `password=`, `secret=`)
- Files: `.env`, `.env.*`, `credentials.*`, `*.pem`, `*.key`
- Hardcoded URLs with credentials
- Base64 encoded secrets

**If ANY secrets are detected: REFUSE to commit those files and explain why.**

### 3. Run Pre-commit Checks
**All checks must pass before creating any commits:**
```bash
go build ./cmd/atl-cli
go test ./...
go vet ./...
```

**If any check fails: STOP and report the error. Do not create commits.**

### 4. Group Changes Logically
Analyze changes and group them into logical commits:
- By package/directory (e.g., `internal/jira/`, `internal/config/`)
- By change type (feat, fix, test, refactor, docs, chore)
- Keep related changes together (implementation + its tests in same commit)

### 5. Create Commits
For each logical group, create a commit using conventional format.

**Commit Message Format:**
```
type(scope): description
```

**Rules:**
- Types: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`, `ci`
- Scope: package or component name (e.g., `jira`, `config`, `cli`)
- Description: imperative mood, lowercase, no period, max 72 chars total
- **NO AI mentions** - no Co-Authored-By, no "generated by", nothing

**Use HEREDOC for commit messages:**
```bash
git add <specific-files>
git commit -m "$(cat <<'EOF'
type(scope): description

Optional body with more details if needed.
EOF
)"
```

### 6. Report Results
After committing, provide a summary:

```
Created N commit(s):

1. type(scope): description
   - file1.go
   - file2.go

2. type(scope): description
   - file3.go

Not committed (N files):
- .env.local: Contains secrets
- unrelated-file.txt: Not related to current changes
```

## Examples

**Single feature commit:**
```
Created 1 commit:

1. feat(jira): add issue get command
   - internal/jira/client.go
   - internal/jira/issue.go
   - cmd/atl-cli/jira.go
```

**Multiple logical commits:**
```
Created 2 commits:

1. feat(config): add yaml configuration support
   - internal/config/config.go
   - internal/config/yaml.go

2. test(config): add configuration unit tests
   - internal/config/config_test.go
   - internal/config/yaml_test.go
```

**With excluded files:**
```
Created 1 commit:

1. fix(jira): handle nil response in client
   - internal/jira/client.go

Not committed (2 files):
- .env: Contains API tokens - use environment variables
- scratch.go: Appears to be temporary/scratch file
```

## Commit Type Reference
| Type | Use for |
|------|---------|
| `feat` | New features |
| `fix` | Bug fixes |
| `docs` | Documentation only |
| `refactor` | Code restructuring without behavior change |
| `test` | Adding or updating tests |
| `chore` | Maintenance tasks, dependencies |
| `ci` | CI/CD configuration |
