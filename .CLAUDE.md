# CLAUDE.md - atl-cli Development Guidelines

## Project Overview
Atlassian Cloud CLI tool for querying Jira and Confluence. Designed for developers, SREs, and code agents requiring deterministic JSON output.

## Quick Reference
```bash
go build ./cmd/atl-cli          # Build
go test ./...                    # Run all tests
go vet ./...                     # Static analysis
golangci-lint run                # Lint (if available)
./atl-cli version                # Verify build
```

## Critical Rules

### 1. Git Workflow
- **Always work on feature branches** - never commit directly to `main`
- **Use conventional commits**: `type(scope): description`
  - Types: `feat`, `fix`, `docs`, `refactor`, `test`, `chore`, `ci`
  - Example: `feat(jira): add issue get command`
- **Create PRs** for all changes to merge into `main`
- **No AI mentions** in commits, code comments, or documentation

### 2. Before Committing
Run all checks and ensure they pass:
```bash
go build ./cmd/atl-cli && go test ./... && go vet ./...
```
**Do not stop until build succeeds and tests pass.**

### 3. Security (NON-NEGOTIABLE)
- **Never commit secrets** - use environment variables only
- Required env vars: `ATLASSIAN_SITE`, `ATLASSIAN_EMAIL`, `ATLASSIAN_TOKEN`
- Never log, print, or expose tokens in any output
- Redact `Authorization` headers in debug output with `[REDACTED]`
- HTTPS only for all requests

### 4. When Uncertain
- **Ask questions** using AskUserQuestion - do not hallucinate or assume
- Check existing patterns in the codebase first
- Reference specs in `/specs/` and `/docs/prd.md`
- Review constitution at `.specify/memory/constitution.md`

### 5. Scope Management
- **Stay focused** on the requested task
- If you discover bugs or scope creep: **create a GitHub issue** to track it, then continue with the original work
- Use: `gh issue create --title "..." --body "..."`

## Code Conventions

### Project Structure
```
cmd/atl-cli/main.go          # Entry point only (minimal)
internal/cli/                # Cobra commands & flag handling
internal/config/             # Environment loading & validation
internal/jira/               # Jira REST API client
internal/confluence/         # Confluence REST API client
```

### Testing (Mandatory)
- **TDD approach**: Write tests first
- Use Go's standard `testing` package
- Table-driven tests preferred
- Mock HTTP responses for API clients
- Test files colocated: `foo.go` â†’ `foo_test.go`

### Output Format
- **All output**: JSON to stdout
- **All errors**: JSON to stderr with `{"error": "...", "message": "..."}`
- Use `json.Encoder` with proper indentation

### Error Handling
- Return meaningful error messages
- Use proper exit codes (0 = success, 1 = error)
- Never expose sensitive data in errors

## Pull Request Guidelines

### Branch Naming
```
<type>/<issue-number>-<short-description>
```
Examples:
- `feat/42-jira-issue-get`
- `fix/15-token-redaction`

### PR Description Template
```markdown
## Summary
Brief description of what this PR does.

## Changes
- List of specific changes made

## Testing
- How the changes were tested
- Commands to verify: `go test ./...`

## Checklist
- [ ] `go build ./cmd/atl-cli` succeeds
- [ ] `go test ./...` passes
- [ ] `go vet ./...` reports no issues
- [ ] No secrets or credentials in code
- [ ] Follows conventional commit format
```

### Creating PRs
```bash
gh pr create --title "feat(scope): description" --body "..."
```

## Dependencies
Keep dependencies minimal. Current: only Cobra for CLI framework.

## Definition of Done
A task is complete when:
1. `go build ./cmd/atl-cli` succeeds
2. `go test ./...` passes
3. `go vet ./...` reports no issues
4. Code follows existing patterns
5. Conventional commit created
6. PR created (if merging to main)
